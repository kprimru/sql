USE [FirstInstall]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF OBJECT_ID('[Income].[INCOME_DELETE]', 'P ') IS NULL EXEC('CREATE PROCEDURE [Income].[INCOME_DELETE]  AS SELECT 1')
GO
ALTER PROCEDURE [Income].[INCOME_DELETE]
	@IN_ID	UNIQUEIDENTIFIER
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @DEST VARCHAR(MAX)

	SET @DEST = ''

	SELECT	@DEST = @DEST + CONVERT(VARCHAR(50), ID_ID) + ','
	FROM	Income.IncomeDetail
	WHERE	ID_ID_INCOME	=	@IN_ID

	IF @DEST <> ''
		SET @DEST = LEFT(@DEST, LEN(@DEST) - 1)

	EXEC Income.INCOME_DETAIL_DELETE @DEST

	DELETE
	FROM	Income.Incomes
	WHERE	IN_ID	=	@IN_ID
END
GO
GRANT EXECUTE ON [Income].[INCOME_DELETE] TO rl_income_d;
GO
