USE [DBF_NAH]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER FUNCTION [Ric].[KBUTotal]
(
	@PR_ID	SMALLINT
)
RETURNS DECIMAL(10, 4)
AS
BEGIN
	DECLARE @RES DECIMAL(10, 4)

	DECLARE @STOCK	DECIMAL(10, 4)

	DECLARE @KBU	DECIMAL(10, 4)

	SET @STOCK = Ric.Stock(@PR_ID)

	SET @KBU = Ric.KBU(@PR_ID)

	IF @STOCK < 1
	BEGIN
		IF @KBU < ((@KBU + @STOCK) / 2)
			SET @RES = @KBU
		ELSE
			SET @RES = (@KBU + @STOCK) / 2
	END
	ELSE
	BEGIN
		SET @RES = @KBU
	END

	RETURN @RES
END
GO
