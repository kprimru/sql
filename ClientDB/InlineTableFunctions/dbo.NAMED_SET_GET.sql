USE [ClientDB]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[NAMED_SET_GET](
	@REF_NAME		NVARCHAR(128)
	)
	RETURNS TABLE
AS
RETURN(
	SELECT
		SetName,
		(SELECT STUFF(CAST((
			SELECT ', '+CAST(SetItem AS VARCHAR)
			FROM dbo.NamedSetsItems NSI
			WHERE NSI.SetId=NS.SetId
			FOR XML PATH(''), TYPE) AS VARCHAR(MAX)), 1, 2, '')
		) AS ItemList
	FROM dbo.NamedSets NS
	WHERE RefName=@REF_NAME
	)